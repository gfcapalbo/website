<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <template id="blog_posts_widget" 
        inherit_id="website.snippets" 
        name="show_blog_post">

        <xpath expr="//div[@id='snippet_content']/div[@class='o_panel_body']" position="inside">
            <div>
                <div class="oe_snippet_thumbnail">
                    <!-- definition of the snippet thumbnail -->
                    <img class="oe_snippet_thumbnail_img" src="/website_snippet_blog_display_post/static/src/img/blocks/block_show_blog_post.png"/>
                    <span class="oe_snippet_thumbnail_title">Show blog post</span>
                </div>
                <section class="oe_snippet_body jq_blg_entry" >
                    <div class="parametricTemplate mt16 mb16">
                        <!-- the template call code is injected via javascript 
                               the class is parametricTemplate in order to 
                               override odoo's normal behaviour 
                               (no t tags allowed except for t-field) -->
                      </div>
                  </section>
              </div>
          </xpath>
          <!-- there we access directly addons/website/static/src/xml/website.snippets.xml and add a new dropdown -->
          <!-- Once accessed our dropdown, menus and functions are documented in 
                addons/website/static/src/js/website.snippets.editor.js   -->

          <xpath expr="//div[@id='snippet_options']" position="inside">
              <div 
                  data-js="dispBlogOptions"
                  data-selector=".jq_blg_entry"
                  data-selector-siblings="p, h1, h2, h3, blockquote, .well, .panel, .oe_share"
                  data-selector-children=".content">
                  <li class="oe_snippet_options dropdown-submenu">
                      <a tabindex="-1" href="#">View from blog </a>
                      <!--todo usure how to unify setting and loop tags check code -->
                      <t t-set="blogs" t-value="request.env['blog.blog'].search([])"/>
                      <ul class="dropdown-menu">
                          <li t-foreach="blogs" t-as="blog" t-att-data-select_value="blog.id" class="dropdown-submenu">
                              <t t-esc="blog.name"/>
                              <t t-set="blog_posts" t-value="request.env['blog.post'].search([('blog_id', '=', blog.id)])"/>
                              <ul class="dropdown-menu">
                                  <li t-if="len(blog_posts) > 0" t-attf-data-select_value="-1_#{blog.id}">
                                      <a>Last Blog Post </a>
                                  </li>
                                  <li t-if="len(blog_posts) > 1" t-attf-data-select_value="-2_#{blog.id}">
                                      <a>Second-Last Blog Post</a>
                                  </li>
                                  <li t-if="len(blog_posts) > 2" t-attf-data-select_value="-3_#{blog.id}">
                                      <a>Third-Last Blog Post</a>
                                  </li>
                                  <li t-if="len(blog_posts) > 3" t-attf-data-select_value="-4_#{blog.id}">
                                      <a>Fourth Last Blog Post</a>
                                  </li>
                                  <li t-if="len(blog_posts) > 4" t-attf-data-select_value="-5_#{blog.id}">
                                      <a>Fifth Last Blog Post</a>
                                  </li>
                                  <li class="dropdown-submenu" data-select_value="0_0" >
                                      <a tabindex="-1" href="#">Or select post directly</a>
                                      <!--todo usure how to unify setting and loop tags check code -->
                                      <ul class="dropdown-menu">
                                          <t t-foreach="blog_posts[:len(blog_posts)]" t-as="blog_post">
                                              <li t-attf-data-select_value="#{blog_post.id}_#{blog.id}">
                                                  <a> <t t-esc="blog_post.name"/> </a>
                                              </li>
                                          </t>
                                      </ul>
                                  </li>
                              </ul>
                          </li>
                      </ul>
                  </li>
              </div>
          </xpath>
      </template>

      <template id="blog_postcontent">
          <t t-set="blogpost" t-value="request.env['blog.post'].get_post(parameter_id,blog_id)"/>
          <div class="col-md-16" t-if="blogpost">
              <t t-if="blogpost.name">
                  <a t-attf-href="/blog/#{ slug(blogpost.blog_id) }/post/#{ slug(blogpost)}">
                      <b> <h4 t-esc="blogpost.name ">
                      </h4></b>
                  </a>
              </t>
              <t t-if="blogpost.teaser">
                  <a t-attf-href="/blog/#{ slug(blogpost.blog_id) }/post/#{ slug(blogpost)}">
                      <p t-esc="blogpost.teaser">
                      </p>
                  </a>
              </t>

              <t t-if="not blogpost.teaser">
                  <p>Selected blog has no teaser</p>
              </t>


          </div>
          <div class="col-md-16" t-if="not blogpost">
              <p>'No blog post selected , please do so by selecting from widget configuration options'</p>
          </div>
      </template>



  </odoo>

